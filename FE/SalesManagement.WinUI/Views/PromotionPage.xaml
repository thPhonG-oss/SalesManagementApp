<Page
    x:Class="SalesManagement.WinUI.Views.PromotionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:SalesManagement.WinUI.Models">

    <Grid Padding="20" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <!-- Desktop: > 1200px -->
                <VisualState x:Name="WideLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1200" />
                    </VisualState.StateTriggers>
                </VisualState>

                <!-- Tablet: 768px - 1199px -->
                <VisualState x:Name="MediumLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="768" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- Giảm spacing -->
                        <Setter Target="ContentGrid.ColumnSpacing" Value="12" />
                        <!-- Điều chỉnh column widths -->
                        <Setter Target="Col1.Width" Value="1.5*" />
                        <Setter Target="Col2.Width" Value="1.5*" />
                        <Setter Target="Col3.Width" Value="1.2*" />
                        <!-- Giảm padding buttons -->
                        <Setter Target="ActionStack.Spacing" Value="6" />
                        <Setter Target="EditBtn.Width" Value="100" />
                        <Setter Target="CancelBtn.Width" Value="100" />
                    </VisualState.Setters>
                </VisualState>

                <!-- Mobile: < 768px -->
                <VisualState x:Name="NarrowLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- Chuyển sang layout dọc -->
                        <Setter Target="ContentGrid.RowSpacing" Value="12" />
                        <Setter Target="ContentGrid.ColumnSpacing" Value="0" />

                        <!-- Ẩn các columns không dùng -->
                        <Setter Target="Col1.Width" Value="*" />
                        <Setter Target="Col2.Width" Value="0" />
                        <Setter Target="Col3.Width" Value="0" />
                        <Setter Target="Col4.Width" Value="0" />

                        <!-- Di chuyển Info sang Row layout -->
                        <Setter Target="InfoStack.Orientation" Value="Vertical" />
                        <Setter Target="DiscountStack.Visibility" Value="Collapsed" />
                        <Setter Target="TimeStack.Visibility" Value="Collapsed" />
                        <Setter Target="ActionStack.Visibility" Value="Collapsed" />

                        <!-- Hiển thị mobile layout -->
                        <Setter Target="MobileLayout.Visibility" Value="Visible" />

                        <!-- Giảm font size cho mobile -->
                        <Setter Target="HeaderText.FontSize" Value="22" />
                        <Setter Target="AddButton.Padding" Value="10,4" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!-- ================= HEADER ================= -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock
                x:Name="HeaderText"
                Text="Quản lý khuyến mãi"
                FontSize="28"
                FontWeight="Bold"
                VerticalAlignment="Center" />

            <Button
                x:Name="AddButton"
                Grid.Column="1"
                Content="+ Thêm khuyến mãi"
                Padding="14,6"
                CornerRadius="6"
                FontWeight="SemiBold"
                Click="AddButton_Click"/>

        </Grid>

        <!-- ================= LIST PROMOTION ================= -->
        <ListView
            Grid.Row="1"
            ItemsSource="{Binding Promotions}"
            SelectionMode="None"
            HorizontalContentAlignment="Stretch">

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:PromotionResponse">

                    <Border
                        Margin="0,6"
                        Padding="14"
                        CornerRadius="10"
                        BorderThickness="1"
                        BorderBrush="{ThemeResource CardStrokeColorDefault}"
                        Background="{ThemeResource CardBackgroundFillColorDefault}">

                        <Grid>
                            <!-- Layout Desktop/Tablet -->
                            <Grid x:Name="ContentGrid" ColumnSpacing="20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition x:Name="Col1" Width="2*" />
                                    <ColumnDefinition x:Name="Col2" Width="2*" />
                                    <ColumnDefinition x:Name="Col3" Width="1.3*" />
                                    <ColumnDefinition x:Name="Col4" Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- ===== CỘT 1: THÔNG TIN ===== -->
                                <StackPanel x:Name="InfoStack" Spacing="6">
                                    <TextBlock
                                        Text="{Binding PromotionName}"
                                        FontSize="16"
                                        FontWeight="SemiBold" />

                                    <TextBlock
                                        Text="{Binding PromotionCode}"
                                        FontSize="12"
                                        Foreground="Gray" />

                                    <TextBlock
                                        Text="{Binding Description}"
                                        TextWrapping="Wrap"
                                        MaxLines="2"
                                        FontSize="13" />
                                </StackPanel>

                                <!-- ===== CỘT 2: GIẢM GIÁ ===== -->
                                <StackPanel x:Name="DiscountStack" Grid.Column="1" Spacing="6">
                                    <TextBlock Text="Giảm giá" FontWeight="SemiBold" />

                                    <TextBlock
                                        Text="{Binding FormattedDiscount}"
                                        FontSize="14"
                                        FontWeight="SemiBold" />

                                    <TextBlock
                                        Text="{Binding FormattedDiscountRange}"
                                        FontSize="12"
                                        Foreground="Gray"
                                        TextWrapping="Wrap" />
                                </StackPanel>

                                <!-- ===== CỘT 3: THỜI GIAN ===== -->
                                <StackPanel x:Name="TimeStack" Grid.Column="2" Spacing="6">
                                    <!-- Badge trạng thái -->
                                    <Border
                                        Padding="10,4"
                                        CornerRadius="14"
                                        HorizontalAlignment="Left"
                                        Background="{Binding StatusBrush}">

                                        <TextBlock
                                            Text="{Binding StatusText}"
                                            Foreground="White"
                                            FontSize="12"
                                            FontWeight="SemiBold" />
                                    </Border>

                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="Thời gian:" />
                                        <TextBlock
                                            Text="{Binding FormattedDateRange}"
                                            FontWeight="SemiBold" />
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="Sử dụng:" />
                                        <TextBlock Text="{Binding UsedCount}" />
                                        <TextBlock Text="/" />
                                        <TextBlock Text="{Binding UsageLimit}" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- ===== CỘT 4: ACTION ===== -->
                                <StackPanel
                                    x:Name="ActionStack"
                                    Grid.Column="3"
                                    VerticalAlignment="Center"
                                    Spacing="8">

                                    <Button
                                        x:Name="EditBtn"
                                        Content="Sửa"
                                        Width="130"
                                        Padding="10,4"
                                        CornerRadius="6"
                                        Click="EditPromotion_Click"/>

                                    <Button
                                        Content="Hủy khuyến mãi"
                                        Click="CancelPromotion_Click"
                                        Background="#FFE5533D"
                                        Foreground="White"
                                        Visibility="{x:Bind statusBool, Mode=OneWay}" />

                                </StackPanel>
                            </Grid>

                            <!-- Layout Mobile (Collapsed by default) -->
                            <StackPanel x:Name="MobileLayout" Spacing="12" Visibility="Collapsed">
                                <!-- Header với status badge -->
                                <Grid>
                                    <StackPanel Spacing="4">
                                        <TextBlock
                                            Text="{Binding PromotionName}"
                                            FontSize="16"
                                            FontWeight="SemiBold"
                                            TextWrapping="Wrap" />

                                        <TextBlock
                                            Text="{Binding PromotionCode}"
                                            FontSize="12"
                                            Foreground="Gray" />
                                    </StackPanel>

                                    <Border
                                        Padding="8,3"
                                        CornerRadius="12"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Background="{Binding StatusBrush}">
                                        <TextBlock
                                            Text="{Binding StatusText}"
                                            Foreground="White"
                                            FontSize="11"
                                            FontWeight="SemiBold" />
                                    </Border>
                                </Grid>

                                <!-- Description -->
                                <TextBlock
                                    Text="{Binding Description}"
                                    TextWrapping="Wrap"
                                    MaxLines="3"
                                    FontSize="13" />

                                <!-- Info Grid -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>

                                    <!-- Discount -->
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Giảm giá" FontSize="12" Foreground="Gray" />
                                        <TextBlock
                                            Text="{Binding FormattedDiscount}"
                                            FontSize="14"
                                            FontWeight="SemiBold" />
                                        <TextBlock
                                            Text="{Binding FormattedDiscountRange}"
                                            FontSize="11"
                                            Foreground="Gray"
                                            TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Usage -->
                                    <StackPanel Grid.Column="1" Spacing="4">
                                        <TextBlock Text="Sử dụng" FontSize="12" Foreground="Gray" />
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <TextBlock Text="{Binding UsedCount}" FontWeight="SemiBold" />
                                            <TextBlock Text="/" />
                                            <TextBlock Text="{Binding UsageLimit}" FontWeight="SemiBold" />
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>

                                <!-- Date Range -->
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Thời gian" FontSize="12" Foreground="Gray" />
                                    <TextBlock
                                        Text="{Binding FormattedDateRange}"
                                        FontSize="13"
                                        TextWrapping="Wrap" />
                                </StackPanel>

                                <!-- Actions -->
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>

                                    <Button
                                        Content="Sửa"
                                        HorizontalAlignment="Stretch"
                                        Padding="8,4"
                                        CornerRadius="6"
                                        Click="EditPromotion_Click"/>

                                    <Button
                                        Grid.Column="1"
                                        Content="Hủy"
                                        HorizontalAlignment="Stretch"
                                        Padding="8,4"
                                        CornerRadius="6"
                                        Background="#FFE5533D"
                                        Foreground="White"
                                        Click="CancelPromotion_Click"
                                        Visibility="{x:Bind statusBool, Mode=OneWay}" />
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </Border>

                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

    </Grid>
</Page>